"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/providers/route";
exports.ids = ["app/api/providers/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fproviders%2Froute&page=%2Fapi%2Fproviders%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fproviders%2Froute.ts&appDir=%2FUsers%2Fvyang%2FDesktop%2Fspaces%2Fmanga_learnjp%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fvyang%2FDesktop%2Fspaces%2Fmanga_learnjp&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fproviders%2Froute&page=%2Fapi%2Fproviders%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fproviders%2Froute.ts&appDir=%2FUsers%2Fvyang%2FDesktop%2Fspaces%2Fmanga_learnjp%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fvyang%2FDesktop%2Fspaces%2Fmanga_learnjp&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var _Users_vyang_Desktop_spaces_manga_learnjp_src_app_api_providers_route_ts__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./src/app/api/providers/route.ts */ \"(rsc)/./src/app/api/providers/route.ts\");\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/providers/route\",\n        pathname: \"/api/providers\",\n        filename: \"route\",\n        bundlePath: \"app/api/providers/route\"\n    },\n    resolvedPagePath: \"/Users/vyang/Desktop/spaces/manga_learnjp/src/app/api/providers/route.ts\",\n    nextConfigOutput,\n    userland: _Users_vyang_Desktop_spaces_manga_learnjp_src_app_api_providers_route_ts__WEBPACK_IMPORTED_MODULE_2__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/providers/route\";\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZwcm92aWRlcnMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnByb3ZpZGVycyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnByb3ZpZGVycyUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRnZ5YW5nJTJGRGVza3RvcCUyRnNwYWNlcyUyRm1hbmdhX2xlYXJuanAlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGdnlhbmclMkZEZXNrdG9wJTJGc3BhY2VzJTJGbWFuZ2FfbGVhcm5qcCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDc0M7QUFDckc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1R0FBdUc7QUFDL0c7QUFDaUo7O0FBRWpKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWFuZ2EtbGVhcm5qcC8/YzA1ZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvdnlhbmcvRGVza3RvcC9zcGFjZXMvbWFuZ2FfbGVhcm5qcC9zcmMvYXBwL2FwaS9wcm92aWRlcnMvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3Byb3ZpZGVycy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3Byb3ZpZGVyc1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvcHJvdmlkZXJzL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL3Z5YW5nL0Rlc2t0b3Avc3BhY2VzL21hbmdhX2xlYXJuanAvc3JjL2FwcC9hcGkvcHJvdmlkZXJzL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL3Byb3ZpZGVycy9yb3V0ZVwiO1xuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQsIG9yaWdpbmFsUGF0aG5hbWUsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fproviders%2Froute&page=%2Fapi%2Fproviders%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fproviders%2Froute.ts&appDir=%2FUsers%2Fvyang%2FDesktop%2Fspaces%2Fmanga_learnjp%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fvyang%2FDesktop%2Fspaces%2Fmanga_learnjp&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/providers/route.ts":
/*!****************************************!*\
  !*** ./src/app/api/providers/route.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_ai_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/ai-service */ \"(rsc)/./src/lib/ai-service.ts\");\n\n\nasync function GET() {\n    try {\n        const openaiApiKey = process.env.OPENAI_API_KEY;\n        const geminiApiKey = process.env.GEMINI_API_KEY;\n        const aiService = new _lib_ai_service__WEBPACK_IMPORTED_MODULE_1__.AIAnalysisService(openaiApiKey, geminiApiKey);\n        const availableProviders = aiService.getAvailableProviders();\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            providers: availableProviders,\n            default: \"openai\" || 0\n        });\n    } catch (error) {\n        console.error(\"Error checking providers:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Failed to check available providers\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9wcm92aWRlcnMvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQTBDO0FBQ1U7QUFFN0MsZUFBZUU7SUFDcEIsSUFBSTtRQUNGLE1BQU1DLGVBQWVDLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYztRQUMvQyxNQUFNQyxlQUFlSCxRQUFRQyxHQUFHLENBQUNHLGNBQWM7UUFFL0MsTUFBTUMsWUFBWSxJQUFJUiw4REFBaUJBLENBQUNFLGNBQWNJO1FBQ3RELE1BQU1HLHFCQUFxQkQsVUFBVUUscUJBQXFCO1FBRTFELE9BQU9YLGtGQUFZQSxDQUFDWSxJQUFJLENBQUM7WUFDdkJDLFdBQVdIO1lBQ1hJLFNBQVNWLFFBQTJDLElBQUk7UUFDMUQ7SUFDRixFQUFFLE9BQU9ZLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLDZCQUE2QkE7UUFDM0MsT0FBT2hCLGtGQUFZQSxDQUFDWSxJQUFJLENBQ3RCO1lBQUVJLE9BQU87UUFBc0MsR0FDL0M7WUFBRUUsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYW5nYS1sZWFybmpwLy4vc3JjL2FwcC9hcGkvcHJvdmlkZXJzL3JvdXRlLnRzP2QwNzIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBBSUFuYWx5c2lzU2VydmljZSB9IGZyb20gJ0AvbGliL2FpLXNlcnZpY2UnXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQoKSB7XG4gIHRyeSB7XG4gICAgY29uc3Qgb3BlbmFpQXBpS2V5ID0gcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVlcbiAgICBjb25zdCBnZW1pbmlBcGlLZXkgPSBwcm9jZXNzLmVudi5HRU1JTklfQVBJX0tFWVxuXG4gICAgY29uc3QgYWlTZXJ2aWNlID0gbmV3IEFJQW5hbHlzaXNTZXJ2aWNlKG9wZW5haUFwaUtleSwgZ2VtaW5pQXBpS2V5KVxuICAgIGNvbnN0IGF2YWlsYWJsZVByb3ZpZGVycyA9IGFpU2VydmljZS5nZXRBdmFpbGFibGVQcm92aWRlcnMoKVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHByb3ZpZGVyczogYXZhaWxhYmxlUHJvdmlkZXJzLFxuICAgICAgZGVmYXVsdDogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfREVGQVVMVF9BSV9QUk9WSURFUiB8fCAnb3BlbmFpJ1xuICAgIH0pXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY2hlY2tpbmcgcHJvdmlkZXJzOicsIGVycm9yKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gY2hlY2sgYXZhaWxhYmxlIHByb3ZpZGVycycgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgIClcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIkFJQW5hbHlzaXNTZXJ2aWNlIiwiR0VUIiwib3BlbmFpQXBpS2V5IiwicHJvY2VzcyIsImVudiIsIk9QRU5BSV9BUElfS0VZIiwiZ2VtaW5pQXBpS2V5IiwiR0VNSU5JX0FQSV9LRVkiLCJhaVNlcnZpY2UiLCJhdmFpbGFibGVQcm92aWRlcnMiLCJnZXRBdmFpbGFibGVQcm92aWRlcnMiLCJqc29uIiwicHJvdmlkZXJzIiwiZGVmYXVsdCIsIk5FWFRfUFVCTElDX0RFRkFVTFRfQUlfUFJPVklERVIiLCJlcnJvciIsImNvbnNvbGUiLCJzdGF0dXMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/providers/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/ai-service.ts":
/*!*******************************!*\
  !*** ./src/lib/ai-service.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AIAnalysisService: () => (/* binding */ AIAnalysisService),\n/* harmony export */   GeminiService: () => (/* binding */ GeminiService),\n/* harmony export */   OpenAIFormatService: () => (/* binding */ OpenAIFormatService),\n/* harmony export */   OpenAIService: () => (/* binding */ OpenAIService)\n/* harmony export */ });\n/* harmony import */ var _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @google/generative-ai */ \"(rsc)/./node_modules/@google/generative-ai/dist/index.mjs\");\n\nconst ANALYSIS_PROMPT = (text)=>`\nYou are a Japanese language learning assistant. ${text ? `Analyze the following Japanese text extracted from manga` : `Look at this manga image and extract all Japanese text, then analyze it`} and provide detailed explanations for language learners.\n\n${text ? `Japanese Text:\\n\"${text}\"` : \"\"}\n\nPlease provide a JSON response with the following structure:\n{\n  \"extractedText\": \"${text ? text : \"All Japanese text found in the image\"}\",\n  \"translation\": \"English translation of the text\",\n  \"summary\": \"Brief context summary explaining what's happening in this manga scene\",\n  \"words\": [\n    {\n      \"word\": \"Japanese word\",\n      \"reading\": \"hiragana/katakana reading\",\n      \"meaning\": \"English meaning\",\n      \"partOfSpeech\": \"noun/verb/adjective/etc\",\n      \"difficulty\": \"beginner/intermediate/advanced\"\n    }\n  ],\n  \"grammar\": [\n    {\n      \"pattern\": \"Grammar pattern found in text\",\n      \"explanation\": \"Detailed explanation of the grammar pattern\",\n      \"example\": \"Example sentence using this pattern\"\n    }\n  ]\n}\n\nFocus on:\n1. ${text ? \"\" : \"First, accurately extracting ALL Japanese text from the manga image (including text in speech bubbles, sound effects, signs, etc.)\"} \n2. Breaking down important vocabulary words, especially those that might be difficult for learners\n3. Identifying key grammar patterns and structures\n4. Providing context for manga-specific language or expressions\n5. Assigning appropriate difficulty levels (beginner: JLPT N5-N4, intermediate: N3-N2, advanced: N1+)\n6. Including furigana readings for kanji\n7. Explaining any colloquialisms, slang, or casual speech patterns common in manga\n8. ${text ? \"\" : \"Recognizing manga sound effects (onomatopoeia) and their meanings\"}\n\nMake sure the response is valid JSON format.`;\nclass OpenAIService {\n    constructor(apiKey){\n        this.apiKey = apiKey;\n    }\n    async analyzeText(text) {\n        const response = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n            method: \"POST\",\n            headers: {\n                \"Authorization\": `Bearer ${this.apiKey}`,\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n                model: \"gpt-4-turbo-preview\",\n                messages: [\n                    {\n                        role: \"system\",\n                        content: \"You are a helpful Japanese language learning assistant that provides detailed analysis of Japanese text for learners. Always respond with valid JSON.\"\n                    },\n                    {\n                        role: \"user\",\n                        content: ANALYSIS_PROMPT(text)\n                    }\n                ],\n                temperature: 0.3,\n                max_tokens: 2000\n            })\n        });\n        if (!response.ok) {\n            throw new Error(`OpenAI API error: ${response.status}`);\n        }\n        const data = await response.json();\n        const content = data.choices[0]?.message?.content;\n        if (!content) {\n            throw new Error(\"No content received from OpenAI\");\n        }\n        const analysisResult = JSON.parse(content);\n        return {\n            ...analysisResult,\n            provider: \"openai\"\n        };\n    }\n    async analyzeImage(imageBase64) {\n        const response = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n            method: \"POST\",\n            headers: {\n                \"Authorization\": `Bearer ${this.apiKey}`,\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n                model: \"gpt-4-vision-preview\",\n                messages: [\n                    {\n                        role: \"system\",\n                        content: \"You are a helpful Japanese language learning assistant that can read Japanese text from manga images and provide detailed analysis for learners. Always respond with valid JSON.\"\n                    },\n                    {\n                        role: \"user\",\n                        content: [\n                            {\n                                type: \"text\",\n                                text: ANALYSIS_PROMPT()\n                            },\n                            {\n                                type: \"image_url\",\n                                image_url: {\n                                    url: `data:image/jpeg;base64,${imageBase64}`\n                                }\n                            }\n                        ]\n                    }\n                ],\n                temperature: 0.3,\n                max_tokens: 2000\n            })\n        });\n        if (!response.ok) {\n            throw new Error(`OpenAI API error: ${response.status}`);\n        }\n        const data = await response.json();\n        const content = data.choices[0]?.message?.content;\n        if (!content) {\n            throw new Error(\"No content received from OpenAI\");\n        }\n        const analysisResult = JSON.parse(content);\n        return {\n            ...analysisResult,\n            provider: \"openai\"\n        };\n    }\n}\nclass GeminiService {\n    constructor(apiKey){\n        this.genAI = new _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenerativeAI(apiKey);\n        this.model = this.genAI.getGenerativeModel({\n            model: \"gemini-1.5-pro\"\n        });\n    }\n    async analyzeText(text) {\n        const prompt = ANALYSIS_PROMPT(text);\n        const result = await this.model.generateContent([\n            {\n                text: prompt\n            }\n        ]);\n        const response = await result.response;\n        const content = response.text();\n        if (!content) {\n            throw new Error(\"No content received from Gemini\");\n        }\n        // Clean up the response to extract JSON\n        const jsonMatch = content.match(/\\{[\\s\\S]*\\}/);\n        if (!jsonMatch) {\n            throw new Error(\"Invalid JSON response from Gemini\");\n        }\n        const analysisResult = JSON.parse(jsonMatch[0]);\n        return {\n            ...analysisResult,\n            provider: \"gemini\"\n        };\n    }\n    async analyzeImage(imageBase64) {\n        const prompt = ANALYSIS_PROMPT();\n        // Convert base64 to format Gemini expects\n        const imagePart = {\n            inlineData: {\n                data: imageBase64,\n                mimeType: \"image/jpeg\"\n            }\n        };\n        const result = await this.model.generateContent([\n            prompt,\n            imagePart\n        ]);\n        const response = await result.response;\n        const content = response.text();\n        if (!content) {\n            throw new Error(\"No content received from Gemini\");\n        }\n        // Clean up the response to extract JSON\n        const jsonMatch = content.match(/\\{[\\s\\S]*\\}/);\n        if (!jsonMatch) {\n            throw new Error(\"Invalid JSON response from Gemini\");\n        }\n        const analysisResult = JSON.parse(jsonMatch[0]);\n        return {\n            ...analysisResult,\n            provider: \"gemini\"\n        };\n    }\n}\nclass OpenAIFormatService {\n    constructor(settings){\n        this.settings = settings;\n    }\n    async analyzeText(text) {\n        const headers = {\n            \"Content-Type\": \"application/json\"\n        };\n        if (this.settings.apiKey) {\n            headers[\"Authorization\"] = `Bearer ${this.settings.apiKey}`;\n        }\n        const response = await fetch(`${this.settings.endpoint}/chat/completions`, {\n            method: \"POST\",\n            headers,\n            body: JSON.stringify({\n                model: this.settings.model,\n                messages: [\n                    {\n                        role: \"system\",\n                        content: \"You are a helpful Japanese language learning assistant that provides detailed analysis of Japanese text for learners. Always respond with valid JSON.\"\n                    },\n                    {\n                        role: \"user\",\n                        content: ANALYSIS_PROMPT(text)\n                    }\n                ],\n                temperature: 0.3,\n                max_tokens: 2000\n            })\n        });\n        if (!response.ok) {\n            throw new Error(`OpenAI-format API error: ${response.status} - ${await response.text()}`);\n        }\n        const data = await response.json();\n        const content = data.choices[0]?.message?.content;\n        if (!content) {\n            throw new Error(\"No content received from OpenAI-format API\");\n        }\n        try {\n            const analysisResult = JSON.parse(content);\n            return {\n                ...analysisResult,\n                provider: \"openai-format\"\n            };\n        } catch (error) {\n            throw new Error(`Failed to parse JSON response: ${content}`);\n        }\n    }\n    async analyzeImage(imageBase64) {\n        const headers = {\n            \"Content-Type\": \"application/json\"\n        };\n        if (this.settings.apiKey) {\n            headers[\"Authorization\"] = `Bearer ${this.settings.apiKey}`;\n        }\n        const response = await fetch(`${this.settings.endpoint}/chat/completions`, {\n            method: \"POST\",\n            headers,\n            body: JSON.stringify({\n                model: this.settings.model,\n                messages: [\n                    {\n                        role: \"system\",\n                        content: \"You are a helpful Japanese language learning assistant that can read Japanese text from manga images and provide detailed analysis for learners. Always respond with valid JSON.\"\n                    },\n                    {\n                        role: \"user\",\n                        content: [\n                            {\n                                type: \"text\",\n                                text: ANALYSIS_PROMPT()\n                            },\n                            {\n                                type: \"image_url\",\n                                image_url: {\n                                    url: `data:image/jpeg;base64,${imageBase64}`\n                                }\n                            }\n                        ]\n                    }\n                ],\n                temperature: 0.3,\n                max_tokens: 2000\n            })\n        });\n        if (!response.ok) {\n            throw new Error(`OpenAI-format API error: ${response.status} - ${await response.text()}`);\n        }\n        const data = await response.json();\n        const content = data.choices[0]?.message?.content;\n        if (!content) {\n            throw new Error(\"No content received from OpenAI-format API\");\n        }\n        try {\n            const analysisResult = JSON.parse(content);\n            return {\n                ...analysisResult,\n                provider: \"openai-format\"\n            };\n        } catch (error) {\n            throw new Error(`Failed to parse JSON response: ${content}`);\n        }\n    }\n}\nclass AIAnalysisService {\n    constructor(openaiKey, geminiKey, openaiFormatSettings){\n        if (openaiKey) {\n            this.openaiService = new OpenAIService(openaiKey);\n        }\n        if (geminiKey) {\n            this.geminiService = new GeminiService(geminiKey);\n        }\n        if (openaiFormatSettings) {\n            this.openaiFormatService = new OpenAIFormatService(openaiFormatSettings);\n        }\n    }\n    async analyzeText(text, provider = \"openai\") {\n        if (provider === \"openai\" && this.openaiService) {\n            return await this.openaiService.analyzeText(text);\n        } else if (provider === \"gemini\" && this.geminiService) {\n            return await this.geminiService.analyzeText(text);\n        } else if (provider === \"openai-format\" && this.openaiFormatService) {\n            return await this.openaiFormatService.analyzeText(text);\n        } else {\n            throw new Error(`${provider} service not available or not configured`);\n        }\n    }\n    async analyzeImage(imageBase64, provider = \"openai\") {\n        if (provider === \"openai\" && this.openaiService) {\n            return await this.openaiService.analyzeImage(imageBase64);\n        } else if (provider === \"gemini\" && this.geminiService) {\n            return await this.geminiService.analyzeImage(imageBase64);\n        } else if (provider === \"openai-format\" && this.openaiFormatService) {\n            return await this.openaiFormatService.analyzeImage(imageBase64);\n        } else {\n            throw new Error(`${provider} service not available or not configured`);\n        }\n    }\n    getAvailableProviders() {\n        const providers = [];\n        if (this.openaiService) providers.push(\"openai\");\n        if (this.geminiService) providers.push(\"gemini\");\n        if (this.openaiFormatService) providers.push(\"openai-format\");\n        return providers;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QztRQUN2QyxJQUFJLElBQUksQ0FBQ0osYUFBYSxFQUFFRyxVQUFVQyxJQUFJLENBQUM7UUFDdkMsSUFBSSxJQUFJLENBQUNILG1CQUFtQixFQUFFRSxVQUFVQyxJQUFJLENBQUM7UUFDN0MsT0FBT0Q7SUFDVDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWFuZ2EtbGVhcm5qcC8uL3NyYy9saWIvYWktc2VydmljZS50cz9mZGU5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdvb2dsZUdlbmVyYXRpdmVBSSB9IGZyb20gJ0Bnb29nbGUvZ2VuZXJhdGl2ZS1haSdcbmltcG9ydCB0eXBlIHsgQUlQcm92aWRlciwgT3BlbkFJRm9ybWF0U2V0dGluZ3MgfSBmcm9tICcuL3R5cGVzJ1xuXG5leHBvcnQgaW50ZXJmYWNlIEFuYWx5c2lzUmVxdWVzdCB7XG4gIHRleHQ6IHN0cmluZ1xuICBwcm92aWRlcj86IEFJUHJvdmlkZXJcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXb3JkQW5hbHlzaXMge1xuICB3b3JkOiBzdHJpbmdcbiAgcmVhZGluZzogc3RyaW5nXG4gIG1lYW5pbmc6IHN0cmluZ1xuICBwYXJ0T2ZTcGVlY2g6IHN0cmluZ1xuICBkaWZmaWN1bHR5OiAnYmVnaW5uZXInIHwgJ2ludGVybWVkaWF0ZScgfCAnYWR2YW5jZWQnXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgR3JhbW1hclBhdHRlcm4ge1xuICBwYXR0ZXJuOiBzdHJpbmdcbiAgZXhwbGFuYXRpb246IHN0cmluZ1xuICBleGFtcGxlOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbmFseXNpc1Jlc3VsdCB7XG4gIGV4dHJhY3RlZFRleHQ6IHN0cmluZ1xuICB3b3JkczogV29yZEFuYWx5c2lzW11cbiAgZ3JhbW1hcjogR3JhbW1hclBhdHRlcm5bXVxuICB0cmFuc2xhdGlvbjogc3RyaW5nXG4gIHN1bW1hcnk6IHN0cmluZ1xuICBwcm92aWRlcjogQUlQcm92aWRlclxufVxuXG5jb25zdCBBTkFMWVNJU19QUk9NUFQgPSAodGV4dD86IHN0cmluZykgPT4gYFxuWW91IGFyZSBhIEphcGFuZXNlIGxhbmd1YWdlIGxlYXJuaW5nIGFzc2lzdGFudC4gJHt0ZXh0ID8gYEFuYWx5emUgdGhlIGZvbGxvd2luZyBKYXBhbmVzZSB0ZXh0IGV4dHJhY3RlZCBmcm9tIG1hbmdhYCA6IGBMb29rIGF0IHRoaXMgbWFuZ2EgaW1hZ2UgYW5kIGV4dHJhY3QgYWxsIEphcGFuZXNlIHRleHQsIHRoZW4gYW5hbHl6ZSBpdGB9IGFuZCBwcm92aWRlIGRldGFpbGVkIGV4cGxhbmF0aW9ucyBmb3IgbGFuZ3VhZ2UgbGVhcm5lcnMuXG5cbiR7dGV4dCA/IGBKYXBhbmVzZSBUZXh0OlxcblwiJHt0ZXh0fVwiYCA6ICcnfVxuXG5QbGVhc2UgcHJvdmlkZSBhIEpTT04gcmVzcG9uc2Ugd2l0aCB0aGUgZm9sbG93aW5nIHN0cnVjdHVyZTpcbntcbiAgXCJleHRyYWN0ZWRUZXh0XCI6IFwiJHt0ZXh0ID8gdGV4dCA6ICdBbGwgSmFwYW5lc2UgdGV4dCBmb3VuZCBpbiB0aGUgaW1hZ2UnfVwiLFxuICBcInRyYW5zbGF0aW9uXCI6IFwiRW5nbGlzaCB0cmFuc2xhdGlvbiBvZiB0aGUgdGV4dFwiLFxuICBcInN1bW1hcnlcIjogXCJCcmllZiBjb250ZXh0IHN1bW1hcnkgZXhwbGFpbmluZyB3aGF0J3MgaGFwcGVuaW5nIGluIHRoaXMgbWFuZ2Egc2NlbmVcIixcbiAgXCJ3b3Jkc1wiOiBbXG4gICAge1xuICAgICAgXCJ3b3JkXCI6IFwiSmFwYW5lc2Ugd29yZFwiLFxuICAgICAgXCJyZWFkaW5nXCI6IFwiaGlyYWdhbmEva2F0YWthbmEgcmVhZGluZ1wiLFxuICAgICAgXCJtZWFuaW5nXCI6IFwiRW5nbGlzaCBtZWFuaW5nXCIsXG4gICAgICBcInBhcnRPZlNwZWVjaFwiOiBcIm5vdW4vdmVyYi9hZGplY3RpdmUvZXRjXCIsXG4gICAgICBcImRpZmZpY3VsdHlcIjogXCJiZWdpbm5lci9pbnRlcm1lZGlhdGUvYWR2YW5jZWRcIlxuICAgIH1cbiAgXSxcbiAgXCJncmFtbWFyXCI6IFtcbiAgICB7XG4gICAgICBcInBhdHRlcm5cIjogXCJHcmFtbWFyIHBhdHRlcm4gZm91bmQgaW4gdGV4dFwiLFxuICAgICAgXCJleHBsYW5hdGlvblwiOiBcIkRldGFpbGVkIGV4cGxhbmF0aW9uIG9mIHRoZSBncmFtbWFyIHBhdHRlcm5cIixcbiAgICAgIFwiZXhhbXBsZVwiOiBcIkV4YW1wbGUgc2VudGVuY2UgdXNpbmcgdGhpcyBwYXR0ZXJuXCJcbiAgICB9XG4gIF1cbn1cblxuRm9jdXMgb246XG4xLiAke3RleHQgPyAnJyA6ICdGaXJzdCwgYWNjdXJhdGVseSBleHRyYWN0aW5nIEFMTCBKYXBhbmVzZSB0ZXh0IGZyb20gdGhlIG1hbmdhIGltYWdlIChpbmNsdWRpbmcgdGV4dCBpbiBzcGVlY2ggYnViYmxlcywgc291bmQgZWZmZWN0cywgc2lnbnMsIGV0Yy4pJ30gXG4yLiBCcmVha2luZyBkb3duIGltcG9ydGFudCB2b2NhYnVsYXJ5IHdvcmRzLCBlc3BlY2lhbGx5IHRob3NlIHRoYXQgbWlnaHQgYmUgZGlmZmljdWx0IGZvciBsZWFybmVyc1xuMy4gSWRlbnRpZnlpbmcga2V5IGdyYW1tYXIgcGF0dGVybnMgYW5kIHN0cnVjdHVyZXNcbjQuIFByb3ZpZGluZyBjb250ZXh0IGZvciBtYW5nYS1zcGVjaWZpYyBsYW5ndWFnZSBvciBleHByZXNzaW9uc1xuNS4gQXNzaWduaW5nIGFwcHJvcHJpYXRlIGRpZmZpY3VsdHkgbGV2ZWxzIChiZWdpbm5lcjogSkxQVCBONS1ONCwgaW50ZXJtZWRpYXRlOiBOMy1OMiwgYWR2YW5jZWQ6IE4xKylcbjYuIEluY2x1ZGluZyBmdXJpZ2FuYSByZWFkaW5ncyBmb3Iga2FuamlcbjcuIEV4cGxhaW5pbmcgYW55IGNvbGxvcXVpYWxpc21zLCBzbGFuZywgb3IgY2FzdWFsIHNwZWVjaCBwYXR0ZXJucyBjb21tb24gaW4gbWFuZ2FcbjguICR7dGV4dCA/ICcnIDogJ1JlY29nbml6aW5nIG1hbmdhIHNvdW5kIGVmZmVjdHMgKG9ub21hdG9wb2VpYSkgYW5kIHRoZWlyIG1lYW5pbmdzJ31cblxuTWFrZSBzdXJlIHRoZSByZXNwb25zZSBpcyB2YWxpZCBKU09OIGZvcm1hdC5gXG5cbmV4cG9ydCBjbGFzcyBPcGVuQUlTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBhcGlLZXk6IHN0cmluZ1xuXG4gIGNvbnN0cnVjdG9yKGFwaUtleTogc3RyaW5nKSB7XG4gICAgdGhpcy5hcGlLZXkgPSBhcGlLZXlcbiAgfVxuXG4gIGFzeW5jIGFuYWx5emVUZXh0KHRleHQ6IHN0cmluZyk6IFByb21pc2U8QW5hbHlzaXNSZXN1bHQ+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCdodHRwczovL2FwaS5vcGVuYWkuY29tL3YxL2NoYXQvY29tcGxldGlvbnMnLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5hcGlLZXl9YCxcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG1vZGVsOiAnZ3B0LTQtdHVyYm8tcHJldmlldycsXG4gICAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgcm9sZTogJ3N5c3RlbScsXG4gICAgICAgICAgICBjb250ZW50OiAnWW91IGFyZSBhIGhlbHBmdWwgSmFwYW5lc2UgbGFuZ3VhZ2UgbGVhcm5pbmcgYXNzaXN0YW50IHRoYXQgcHJvdmlkZXMgZGV0YWlsZWQgYW5hbHlzaXMgb2YgSmFwYW5lc2UgdGV4dCBmb3IgbGVhcm5lcnMuIEFsd2F5cyByZXNwb25kIHdpdGggdmFsaWQgSlNPTi4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICByb2xlOiAndXNlcicsXG4gICAgICAgICAgICBjb250ZW50OiBBTkFMWVNJU19QUk9NUFQodGV4dClcbiAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIHRlbXBlcmF0dXJlOiAwLjMsXG4gICAgICAgIG1heF90b2tlbnM6IDIwMDAsXG4gICAgICB9KSxcbiAgICB9KVxuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBPcGVuQUkgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gKVxuICAgIH1cblxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKClcbiAgICBjb25zdCBjb250ZW50ID0gZGF0YS5jaG9pY2VzWzBdPy5tZXNzYWdlPy5jb250ZW50XG5cbiAgICBpZiAoIWNvbnRlbnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gY29udGVudCByZWNlaXZlZCBmcm9tIE9wZW5BSScpXG4gICAgfVxuXG4gICAgY29uc3QgYW5hbHlzaXNSZXN1bHQgPSBKU09OLnBhcnNlKGNvbnRlbnQpXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmFuYWx5c2lzUmVzdWx0LFxuICAgICAgcHJvdmlkZXI6ICdvcGVuYWknIGFzIEFJUHJvdmlkZXJcbiAgICB9XG4gIH1cblxuICBhc3luYyBhbmFseXplSW1hZ2UoaW1hZ2VCYXNlNjQ6IHN0cmluZyk6IFByb21pc2U8QW5hbHlzaXNSZXN1bHQ+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCdodHRwczovL2FwaS5vcGVuYWkuY29tL3YxL2NoYXQvY29tcGxldGlvbnMnLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5hcGlLZXl9YCxcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG1vZGVsOiAnZ3B0LTQtdmlzaW9uLXByZXZpZXcnLFxuICAgICAgICBtZXNzYWdlczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJvbGU6ICdzeXN0ZW0nLFxuICAgICAgICAgICAgY29udGVudDogJ1lvdSBhcmUgYSBoZWxwZnVsIEphcGFuZXNlIGxhbmd1YWdlIGxlYXJuaW5nIGFzc2lzdGFudCB0aGF0IGNhbiByZWFkIEphcGFuZXNlIHRleHQgZnJvbSBtYW5nYSBpbWFnZXMgYW5kIHByb3ZpZGUgZGV0YWlsZWQgYW5hbHlzaXMgZm9yIGxlYXJuZXJzLiBBbHdheXMgcmVzcG9uZCB3aXRoIHZhbGlkIEpTT04uJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgICAgICAgY29udGVudDogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICAgIHRleHQ6IEFOQUxZU0lTX1BST01QVCgpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnaW1hZ2VfdXJsJyxcbiAgICAgICAgICAgICAgICBpbWFnZV91cmw6IHtcbiAgICAgICAgICAgICAgICAgIHVybDogYGRhdGE6aW1hZ2UvanBlZztiYXNlNjQsJHtpbWFnZUJhc2U2NH1gXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdXG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICB0ZW1wZXJhdHVyZTogMC4zLFxuICAgICAgICBtYXhfdG9rZW5zOiAyMDAwLFxuICAgICAgfSksXG4gICAgfSlcblxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgT3BlbkFJIEFQSSBlcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9YClcbiAgICB9XG5cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpXG4gICAgY29uc3QgY29udGVudCA9IGRhdGEuY2hvaWNlc1swXT8ubWVzc2FnZT8uY29udGVudFxuXG4gICAgaWYgKCFjb250ZW50KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGNvbnRlbnQgcmVjZWl2ZWQgZnJvbSBPcGVuQUknKVxuICAgIH1cblxuICAgIGNvbnN0IGFuYWx5c2lzUmVzdWx0ID0gSlNPTi5wYXJzZShjb250ZW50KVxuICAgIHJldHVybiB7XG4gICAgICAuLi5hbmFseXNpc1Jlc3VsdCxcbiAgICAgIHByb3ZpZGVyOiAnb3BlbmFpJyBhcyBBSVByb3ZpZGVyXG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBHZW1pbmlTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBnZW5BSTogR29vZ2xlR2VuZXJhdGl2ZUFJXG4gIHByaXZhdGUgbW9kZWw6IGFueVxuXG4gIGNvbnN0cnVjdG9yKGFwaUtleTogc3RyaW5nKSB7XG4gICAgdGhpcy5nZW5BSSA9IG5ldyBHb29nbGVHZW5lcmF0aXZlQUkoYXBpS2V5KVxuICAgIHRoaXMubW9kZWwgPSB0aGlzLmdlbkFJLmdldEdlbmVyYXRpdmVNb2RlbCh7IG1vZGVsOiAnZ2VtaW5pLTEuNS1wcm8nIH0pXG4gIH1cblxuICBhc3luYyBhbmFseXplVGV4dCh0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPEFuYWx5c2lzUmVzdWx0PiB7XG4gICAgY29uc3QgcHJvbXB0ID0gQU5BTFlTSVNfUFJPTVBUKHRleHQpXG4gICAgXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5tb2RlbC5nZW5lcmF0ZUNvbnRlbnQoW1xuICAgICAge1xuICAgICAgICB0ZXh0OiBwcm9tcHRcbiAgICAgIH1cbiAgICBdKVxuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXN1bHQucmVzcG9uc2VcbiAgICBjb25zdCBjb250ZW50ID0gcmVzcG9uc2UudGV4dCgpXG5cbiAgICBpZiAoIWNvbnRlbnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gY29udGVudCByZWNlaXZlZCBmcm9tIEdlbWluaScpXG4gICAgfVxuXG4gICAgLy8gQ2xlYW4gdXAgdGhlIHJlc3BvbnNlIHRvIGV4dHJhY3QgSlNPTlxuICAgIGNvbnN0IGpzb25NYXRjaCA9IGNvbnRlbnQubWF0Y2goL1xce1tcXHNcXFNdKlxcfS8pXG4gICAgaWYgKCFqc29uTWF0Y2gpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBKU09OIHJlc3BvbnNlIGZyb20gR2VtaW5pJylcbiAgICB9XG5cbiAgICBjb25zdCBhbmFseXNpc1Jlc3VsdCA9IEpTT04ucGFyc2UoanNvbk1hdGNoWzBdKVxuICAgIHJldHVybiB7XG4gICAgICAuLi5hbmFseXNpc1Jlc3VsdCxcbiAgICAgIHByb3ZpZGVyOiAnZ2VtaW5pJyBhcyBBSVByb3ZpZGVyXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgYW5hbHl6ZUltYWdlKGltYWdlQmFzZTY0OiBzdHJpbmcpOiBQcm9taXNlPEFuYWx5c2lzUmVzdWx0PiB7XG4gICAgY29uc3QgcHJvbXB0ID0gQU5BTFlTSVNfUFJPTVBUKClcbiAgICBcbiAgICAvLyBDb252ZXJ0IGJhc2U2NCB0byBmb3JtYXQgR2VtaW5pIGV4cGVjdHNcbiAgICBjb25zdCBpbWFnZVBhcnQgPSB7XG4gICAgICBpbmxpbmVEYXRhOiB7XG4gICAgICAgIGRhdGE6IGltYWdlQmFzZTY0LFxuICAgICAgICBtaW1lVHlwZTogJ2ltYWdlL2pwZWcnXG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5tb2RlbC5nZW5lcmF0ZUNvbnRlbnQoW1xuICAgICAgcHJvbXB0LFxuICAgICAgaW1hZ2VQYXJ0XG4gICAgXSlcblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVzdWx0LnJlc3BvbnNlXG4gICAgY29uc3QgY29udGVudCA9IHJlc3BvbnNlLnRleHQoKVxuXG4gICAgaWYgKCFjb250ZW50KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGNvbnRlbnQgcmVjZWl2ZWQgZnJvbSBHZW1pbmknKVxuICAgIH1cblxuICAgIC8vIENsZWFuIHVwIHRoZSByZXNwb25zZSB0byBleHRyYWN0IEpTT05cbiAgICBjb25zdCBqc29uTWF0Y2ggPSBjb250ZW50Lm1hdGNoKC9cXHtbXFxzXFxTXSpcXH0vKVxuICAgIGlmICghanNvbk1hdGNoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgSlNPTiByZXNwb25zZSBmcm9tIEdlbWluaScpXG4gICAgfVxuXG4gICAgY29uc3QgYW5hbHlzaXNSZXN1bHQgPSBKU09OLnBhcnNlKGpzb25NYXRjaFswXSlcbiAgICByZXR1cm4ge1xuICAgICAgLi4uYW5hbHlzaXNSZXN1bHQsXG4gICAgICBwcm92aWRlcjogJ2dlbWluaScgYXMgQUlQcm92aWRlclxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgT3BlbkFJRm9ybWF0U2VydmljZSB7XG4gIHByaXZhdGUgc2V0dGluZ3M6IE9wZW5BSUZvcm1hdFNldHRpbmdzXG5cbiAgY29uc3RydWN0b3Ioc2V0dGluZ3M6IE9wZW5BSUZvcm1hdFNldHRpbmdzKSB7XG4gICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzXG4gIH1cblxuICBhc3luYyBhbmFseXplVGV4dCh0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPEFuYWx5c2lzUmVzdWx0PiB7XG4gICAgY29uc3QgaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgfVxuICAgIFxuICAgIGlmICh0aGlzLnNldHRpbmdzLmFwaUtleSkge1xuICAgICAgaGVhZGVyc1snQXV0aG9yaXphdGlvbiddID0gYEJlYXJlciAke3RoaXMuc2V0dGluZ3MuYXBpS2V5fWBcbiAgICB9XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuc2V0dGluZ3MuZW5kcG9pbnR9L2NoYXQvY29tcGxldGlvbnNgLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG1vZGVsOiB0aGlzLnNldHRpbmdzLm1vZGVsLFxuICAgICAgICBtZXNzYWdlczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJvbGU6ICdzeXN0ZW0nLFxuICAgICAgICAgICAgY29udGVudDogJ1lvdSBhcmUgYSBoZWxwZnVsIEphcGFuZXNlIGxhbmd1YWdlIGxlYXJuaW5nIGFzc2lzdGFudCB0aGF0IHByb3ZpZGVzIGRldGFpbGVkIGFuYWx5c2lzIG9mIEphcGFuZXNlIHRleHQgZm9yIGxlYXJuZXJzLiBBbHdheXMgcmVzcG9uZCB3aXRoIHZhbGlkIEpTT04uJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgICAgICAgY29udGVudDogQU5BTFlTSVNfUFJPTVBUKHRleHQpXG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICB0ZW1wZXJhdHVyZTogMC4zLFxuICAgICAgICBtYXhfdG9rZW5zOiAyMDAwLFxuICAgICAgfSksXG4gICAgfSlcblxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgT3BlbkFJLWZvcm1hdCBBUEkgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfSAtICR7YXdhaXQgcmVzcG9uc2UudGV4dCgpfWApXG4gICAgfVxuXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgIGNvbnN0IGNvbnRlbnQgPSBkYXRhLmNob2ljZXNbMF0/Lm1lc3NhZ2U/LmNvbnRlbnRcblxuICAgIGlmICghY29udGVudCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBjb250ZW50IHJlY2VpdmVkIGZyb20gT3BlbkFJLWZvcm1hdCBBUEknKVxuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBhbmFseXNpc1Jlc3VsdCA9IEpTT04ucGFyc2UoY29udGVudClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmFuYWx5c2lzUmVzdWx0LFxuICAgICAgICBwcm92aWRlcjogJ29wZW5haS1mb3JtYXQnIGFzIEFJUHJvdmlkZXJcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gcGFyc2UgSlNPTiByZXNwb25zZTogJHtjb250ZW50fWApXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgYW5hbHl6ZUltYWdlKGltYWdlQmFzZTY0OiBzdHJpbmcpOiBQcm9taXNlPEFuYWx5c2lzUmVzdWx0PiB7XG4gICAgY29uc3QgaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgfVxuICAgIFxuICAgIGlmICh0aGlzLnNldHRpbmdzLmFwaUtleSkge1xuICAgICAgaGVhZGVyc1snQXV0aG9yaXphdGlvbiddID0gYEJlYXJlciAke3RoaXMuc2V0dGluZ3MuYXBpS2V5fWBcbiAgICB9XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuc2V0dGluZ3MuZW5kcG9pbnR9L2NoYXQvY29tcGxldGlvbnNgLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG1vZGVsOiB0aGlzLnNldHRpbmdzLm1vZGVsLFxuICAgICAgICBtZXNzYWdlczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJvbGU6ICdzeXN0ZW0nLFxuICAgICAgICAgICAgY29udGVudDogJ1lvdSBhcmUgYSBoZWxwZnVsIEphcGFuZXNlIGxhbmd1YWdlIGxlYXJuaW5nIGFzc2lzdGFudCB0aGF0IGNhbiByZWFkIEphcGFuZXNlIHRleHQgZnJvbSBtYW5nYSBpbWFnZXMgYW5kIHByb3ZpZGUgZGV0YWlsZWQgYW5hbHlzaXMgZm9yIGxlYXJuZXJzLiBBbHdheXMgcmVzcG9uZCB3aXRoIHZhbGlkIEpTT04uJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgICAgICAgY29udGVudDogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICAgIHRleHQ6IEFOQUxZU0lTX1BST01QVCgpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnaW1hZ2VfdXJsJyxcbiAgICAgICAgICAgICAgICBpbWFnZV91cmw6IHtcbiAgICAgICAgICAgICAgICAgIHVybDogYGRhdGE6aW1hZ2UvanBlZztiYXNlNjQsJHtpbWFnZUJhc2U2NH1gXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdXG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICB0ZW1wZXJhdHVyZTogMC4zLFxuICAgICAgICBtYXhfdG9rZW5zOiAyMDAwLFxuICAgICAgfSksXG4gICAgfSlcblxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgT3BlbkFJLWZvcm1hdCBBUEkgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfSAtICR7YXdhaXQgcmVzcG9uc2UudGV4dCgpfWApXG4gICAgfVxuXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgIGNvbnN0IGNvbnRlbnQgPSBkYXRhLmNob2ljZXNbMF0/Lm1lc3NhZ2U/LmNvbnRlbnRcblxuICAgIGlmICghY29udGVudCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBjb250ZW50IHJlY2VpdmVkIGZyb20gT3BlbkFJLWZvcm1hdCBBUEknKVxuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBhbmFseXNpc1Jlc3VsdCA9IEpTT04ucGFyc2UoY29udGVudClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmFuYWx5c2lzUmVzdWx0LFxuICAgICAgICBwcm92aWRlcjogJ29wZW5haS1mb3JtYXQnIGFzIEFJUHJvdmlkZXJcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gcGFyc2UgSlNPTiByZXNwb25zZTogJHtjb250ZW50fWApXG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBBSUFuYWx5c2lzU2VydmljZSB7XG4gIHByaXZhdGUgb3BlbmFpU2VydmljZT86IE9wZW5BSVNlcnZpY2VcbiAgcHJpdmF0ZSBnZW1pbmlTZXJ2aWNlPzogR2VtaW5pU2VydmljZVxuICBwcml2YXRlIG9wZW5haUZvcm1hdFNlcnZpY2U/OiBPcGVuQUlGb3JtYXRTZXJ2aWNlXG5cbiAgY29uc3RydWN0b3Iob3BlbmFpS2V5Pzogc3RyaW5nLCBnZW1pbmlLZXk/OiBzdHJpbmcsIG9wZW5haUZvcm1hdFNldHRpbmdzPzogT3BlbkFJRm9ybWF0U2V0dGluZ3MpIHtcbiAgICBpZiAob3BlbmFpS2V5KSB7XG4gICAgICB0aGlzLm9wZW5haVNlcnZpY2UgPSBuZXcgT3BlbkFJU2VydmljZShvcGVuYWlLZXkpXG4gICAgfVxuICAgIGlmIChnZW1pbmlLZXkpIHtcbiAgICAgIHRoaXMuZ2VtaW5pU2VydmljZSA9IG5ldyBHZW1pbmlTZXJ2aWNlKGdlbWluaUtleSlcbiAgICB9XG4gICAgaWYgKG9wZW5haUZvcm1hdFNldHRpbmdzKSB7XG4gICAgICB0aGlzLm9wZW5haUZvcm1hdFNlcnZpY2UgPSBuZXcgT3BlbkFJRm9ybWF0U2VydmljZShvcGVuYWlGb3JtYXRTZXR0aW5ncylcbiAgICB9XG4gIH1cblxuICBhc3luYyBhbmFseXplVGV4dCh0ZXh0OiBzdHJpbmcsIHByb3ZpZGVyOiBBSVByb3ZpZGVyID0gJ29wZW5haScpOiBQcm9taXNlPEFuYWx5c2lzUmVzdWx0PiB7XG4gICAgaWYgKHByb3ZpZGVyID09PSAnb3BlbmFpJyAmJiB0aGlzLm9wZW5haVNlcnZpY2UpIHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLm9wZW5haVNlcnZpY2UuYW5hbHl6ZVRleHQodGV4dClcbiAgICB9IGVsc2UgaWYgKHByb3ZpZGVyID09PSAnZ2VtaW5pJyAmJiB0aGlzLmdlbWluaVNlcnZpY2UpIHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdlbWluaVNlcnZpY2UuYW5hbHl6ZVRleHQodGV4dClcbiAgICB9IGVsc2UgaWYgKHByb3ZpZGVyID09PSAnb3BlbmFpLWZvcm1hdCcgJiYgdGhpcy5vcGVuYWlGb3JtYXRTZXJ2aWNlKSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5vcGVuYWlGb3JtYXRTZXJ2aWNlLmFuYWx5emVUZXh0KHRleHQpXG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgJHtwcm92aWRlcn0gc2VydmljZSBub3QgYXZhaWxhYmxlIG9yIG5vdCBjb25maWd1cmVkYClcbiAgICB9XG4gIH1cblxuICBhc3luYyBhbmFseXplSW1hZ2UoaW1hZ2VCYXNlNjQ6IHN0cmluZywgcHJvdmlkZXI6IEFJUHJvdmlkZXIgPSAnb3BlbmFpJyk6IFByb21pc2U8QW5hbHlzaXNSZXN1bHQ+IHtcbiAgICBpZiAocHJvdmlkZXIgPT09ICdvcGVuYWknICYmIHRoaXMub3BlbmFpU2VydmljZSkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMub3BlbmFpU2VydmljZS5hbmFseXplSW1hZ2UoaW1hZ2VCYXNlNjQpXG4gICAgfSBlbHNlIGlmIChwcm92aWRlciA9PT0gJ2dlbWluaScgJiYgdGhpcy5nZW1pbmlTZXJ2aWNlKSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZW1pbmlTZXJ2aWNlLmFuYWx5emVJbWFnZShpbWFnZUJhc2U2NClcbiAgICB9IGVsc2UgaWYgKHByb3ZpZGVyID09PSAnb3BlbmFpLWZvcm1hdCcgJiYgdGhpcy5vcGVuYWlGb3JtYXRTZXJ2aWNlKSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5vcGVuYWlGb3JtYXRTZXJ2aWNlLmFuYWx5emVJbWFnZShpbWFnZUJhc2U2NClcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGAke3Byb3ZpZGVyfSBzZXJ2aWNlIG5vdCBhdmFpbGFibGUgb3Igbm90IGNvbmZpZ3VyZWRgKVxuICAgIH1cbiAgfVxuXG4gIGdldEF2YWlsYWJsZVByb3ZpZGVycygpOiBBSVByb3ZpZGVyW10ge1xuICAgIGNvbnN0IHByb3ZpZGVyczogQUlQcm92aWRlcltdID0gW11cbiAgICBpZiAodGhpcy5vcGVuYWlTZXJ2aWNlKSBwcm92aWRlcnMucHVzaCgnb3BlbmFpJylcbiAgICBpZiAodGhpcy5nZW1pbmlTZXJ2aWNlKSBwcm92aWRlcnMucHVzaCgnZ2VtaW5pJylcbiAgICBpZiAodGhpcy5vcGVuYWlGb3JtYXRTZXJ2aWNlKSBwcm92aWRlcnMucHVzaCgnb3BlbmFpLWZvcm1hdCcpXG4gICAgcmV0dXJuIHByb3ZpZGVyc1xuICB9XG59XG4iXSwibmFtZXMiOlsiR29vZ2xlR2VuZXJhdGl2ZUFJIiwiQU5BTFlTSVNfUFJPTVBUIiwidGV4dCIsIk9wZW5BSVNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsImFwaUtleSIsImFuYWx5emVUZXh0IiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIm1vZGVsIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsInRlbXBlcmF0dXJlIiwibWF4X3Rva2VucyIsIm9rIiwiRXJyb3IiLCJzdGF0dXMiLCJkYXRhIiwianNvbiIsImNob2ljZXMiLCJtZXNzYWdlIiwiYW5hbHlzaXNSZXN1bHQiLCJwYXJzZSIsInByb3ZpZGVyIiwiYW5hbHl6ZUltYWdlIiwiaW1hZ2VCYXNlNjQiLCJ0eXBlIiwiaW1hZ2VfdXJsIiwidXJsIiwiR2VtaW5pU2VydmljZSIsImdlbkFJIiwiZ2V0R2VuZXJhdGl2ZU1vZGVsIiwicHJvbXB0IiwicmVzdWx0IiwiZ2VuZXJhdGVDb250ZW50IiwianNvbk1hdGNoIiwibWF0Y2giLCJpbWFnZVBhcnQiLCJpbmxpbmVEYXRhIiwibWltZVR5cGUiLCJPcGVuQUlGb3JtYXRTZXJ2aWNlIiwic2V0dGluZ3MiLCJlbmRwb2ludCIsImVycm9yIiwiQUlBbmFseXNpc1NlcnZpY2UiLCJvcGVuYWlLZXkiLCJnZW1pbmlLZXkiLCJvcGVuYWlGb3JtYXRTZXR0aW5ncyIsIm9wZW5haVNlcnZpY2UiLCJnZW1pbmlTZXJ2aWNlIiwib3BlbmFpRm9ybWF0U2VydmljZSIsImdldEF2YWlsYWJsZVByb3ZpZGVycyIsInByb3ZpZGVycyIsInB1c2giXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/ai-service.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@google"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fproviders%2Froute&page=%2Fapi%2Fproviders%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fproviders%2Froute.ts&appDir=%2FUsers%2Fvyang%2FDesktop%2Fspaces%2Fmanga_learnjp%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fvyang%2FDesktop%2Fspaces%2Fmanga_learnjp&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();